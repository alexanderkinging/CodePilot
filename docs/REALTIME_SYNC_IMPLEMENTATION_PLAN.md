# CodePilot å®æ—¶åŒæ­¥åŠŸèƒ½å¼€å‘è®¡åˆ’

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

**åŠŸèƒ½åç§°**: å®æ—¶æ–‡ä»¶ç›‘å¬ä¸ CLI åŒæ­¥
**ä¼˜å…ˆçº§**: é•¿æœŸä¼˜åŒ–
**é¢„è®¡å·¥ä½œé‡**: 3-5 å¤©
**æœ€åæ›´æ–°**: 2026-02-08

---

## ğŸ¯ åŠŸèƒ½ç›®æ ‡

å®ç° CodePilot ä¸ Claude CLI ä¹‹é—´çš„**å®æ—¶åŒå‘åŒæ­¥**ï¼Œè®©ç”¨æˆ·åœ¨ CLI ä¸­çš„æ“ä½œèƒ½å¤Ÿè‡ªåŠ¨åæ˜ åˆ° CodePilot ç•Œé¢ä¸­ã€‚

### æ ¸å¿ƒä»·å€¼
- âœ… ç”¨æˆ·åœ¨ CLI ä¸­ç»§ç»­å¯¹è¯ â†’ CodePilot è‡ªåŠ¨æ˜¾ç¤ºæ–°æ¶ˆæ¯
- âœ… æ— éœ€æ‰‹åŠ¨åˆ·æ–°æˆ–é‡æ–°å¯¼å…¥
- âœ… çœŸæ­£çš„åŒå‘å·¥ä½œæµä½“éªŒ

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Electron Main Process                                   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ FileWatcherService                              â”‚   â”‚
â”‚  â”‚ - ä½¿ç”¨ chokidar ç›‘å¬ ~/.claude/projects/       â”‚   â”‚
â”‚  â”‚ - åªç›‘å¬å·²å¯¼å…¥çš„ä¼šè¯                            â”‚   â”‚
â”‚  â”‚ - é˜²æŠ–å¤„ç†ï¼ˆé¿å…é¢‘ç¹è§¦å‘ï¼‰                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚ æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–                     â”‚
â”‚                    â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SyncEngine                                      â”‚   â”‚
â”‚  â”‚ - è§£æ JSONL æ–‡ä»¶                               â”‚   â”‚
â”‚  â”‚ - æå–æ–°æ¶ˆæ¯ï¼ˆåŸºäºæ—¶é—´æˆ³å»é‡ï¼‰                  â”‚   â”‚
â”‚  â”‚ - æ‰¹é‡æ›´æ–° SQLite æ•°æ®åº“                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                    â”‚ åŒæ­¥å®Œæˆ                           â”‚
â”‚                    â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ IPC é€šä¿¡                                        â”‚   â”‚
â”‚  â”‚ - å‘é€ 'sync-messages' äº‹ä»¶åˆ°æ¸²æŸ“è¿›ç¨‹          â”‚   â”‚
â”‚  â”‚ - æºå¸¦ sessionId å’Œæ–°æ¶ˆæ¯æ•°é‡                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Renderer Process (React)                                â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ useSyncListener Hook                            â”‚   â”‚
â”‚  â”‚ - ç›‘å¬ 'sync-messages' äº‹ä»¶                     â”‚   â”‚
â”‚  â”‚ - è§¦å‘æ¶ˆæ¯åˆ—è¡¨åˆ·æ–°                              â”‚   â”‚
â”‚  â”‚ - æ˜¾ç¤ºåŒæ­¥é€šçŸ¥                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SyncStatusIndicator                             â”‚   â”‚
â”‚  â”‚ - æ˜¾ç¤ºåŒæ­¥çŠ¶æ€ï¼ˆåŒæ­¥ä¸­/å·²åŒæ­¥/é”™è¯¯ï¼‰           â”‚   â”‚
â”‚  â”‚ - æ˜¾ç¤ºæœ€ååŒæ­¥æ—¶é—´                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

### æ–°å¢æ–‡ä»¶

```
electron/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ file-watcher.ts          # æ–‡ä»¶ç›‘å¬æœåŠ¡
â”‚   â”œâ”€â”€ sync-engine.ts            # åŒæ­¥å¼•æ“
â”‚   â””â”€â”€ transcript-parser.ts      # Transcript æ–‡ä»¶è§£æå™¨
â”‚
src/
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useSyncListener.ts        # React Hookï¼šç›‘å¬åŒæ­¥äº‹ä»¶
â”‚
â”œâ”€â”€ components/
â”‚   â””â”€â”€ sync/
â”‚       â”œâ”€â”€ SyncStatusIndicator.tsx   # åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨
â”‚       â””â”€â”€ SyncSettings.tsx          # åŒæ­¥è®¾ç½®é¢æ¿
â”‚
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ sync-utils.ts             # åŒæ­¥å·¥å…·å‡½æ•°
â”‚
â””â”€â”€ types/
    â””â”€â”€ sync.ts                   # åŒæ­¥ç›¸å…³ç±»å‹å®šä¹‰
```

### ä¿®æ”¹æ–‡ä»¶

```
electron/main.ts                  # åˆå§‹åŒ–æ–‡ä»¶ç›‘å¬æœåŠ¡
src/app/settings/page.tsx         # æ·»åŠ åŒæ­¥è®¾ç½® UI
src/app/chat/[id]/page.tsx        # é›†æˆåŒæ­¥çŠ¶æ€æ˜¾ç¤º
src/lib/db.ts                     # æ·»åŠ åŒæ­¥ç›¸å…³æ•°æ®åº“æ“ä½œ
```

---

## ğŸ”§ å®ç°ç»†èŠ‚

### ç¬¬ä¸€æ­¥ï¼šæ–‡ä»¶ç›‘å¬æœåŠ¡ (file-watcher.ts)

**ä½ç½®**: `electron/services/file-watcher.ts`

**ä¾èµ–å®‰è£…**:
```bash
npm install chokidar
npm install --save-dev @types/chokidar
```

**æ ¸å¿ƒåŠŸèƒ½**:
1. ç›‘å¬ `~/.claude/projects/**/*.jsonl` æ–‡ä»¶å˜åŒ–
2. åªç›‘å¬å·²å¯¼å…¥åˆ° CodePilot çš„ä¼šè¯
3. é˜²æŠ–å¤„ç†ï¼ˆ500msï¼‰é¿å…é¢‘ç¹è§¦å‘
4. æ”¯æŒå¯ç”¨/ç¦ç”¨ç›‘å¬

**å…³é”®ä»£ç ç»“æ„**:
```typescript
import { watch, FSWatcher } from 'chokidar';
import { homedir } from 'os';
import path from 'path';
import { getDb } from '../lib/db';

export class FileWatcherService {
  private watcher: FSWatcher | null = null;
  private enabled: boolean = false;
  private debounceTimers: Map<string, NodeJS.Timeout> = new Map();

  constructor(
    private onFileChange: (sessionId: string, filePath: string) => void
  ) {}

  start(): void {
    // å®ç°ç›‘å¬é€»è¾‘
  }

  stop(): void {
    // åœæ­¢ç›‘å¬
  }

  private handleFileChange(filePath: string): void {
    // é˜²æŠ–å¤„ç†
    // æå– sessionId
    // æ£€æŸ¥æ˜¯å¦æ˜¯å·²å¯¼å…¥çš„ä¼šè¯
    // è§¦å‘å›è°ƒ
  }
}
```

**æ³¨æ„äº‹é¡¹**:
- âš ï¸ åªç›‘å¬å·²å¯¼å…¥çš„ä¼šè¯ï¼ˆæŸ¥è¯¢æ•°æ®åº“ï¼‰
- âš ï¸ ä½¿ç”¨é˜²æŠ–é¿å…é¢‘ç¹è§¦å‘
- ï¿½ï¿½ï¿½ï¸ å¤„ç†æ–‡ä»¶åˆ é™¤/é‡å‘½åç­‰è¾¹ç¼˜æƒ…å†µ
- âš ï¸ ç›‘å¬å™¨éœ€è¦åœ¨åº”ç”¨é€€å‡ºæ—¶æ­£ç¡®æ¸…ç†

---

### ç¬¬äºŒæ­¥ï¼šTranscript è§£æå™¨ (transcript-parser.ts)

**ä½ç½®**: `electron/services/transcript-parser.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
1. è§£æ JSONL æ ¼å¼çš„ transcript æ–‡ä»¶
2. æå–ç”¨æˆ·å’ŒåŠ©æ‰‹æ¶ˆæ¯
3. åŸºäºæ—¶é—´æˆ³è¿‡æ»¤æ–°æ¶ˆæ¯
4. å¤„ç†å„ç§æ¶ˆæ¯æ ¼å¼ï¼ˆæ–‡æœ¬ã€å·¥å…·è°ƒç”¨ç­‰ï¼‰

**å…³é”®ä»£ç ç»“æ„**:
```typescript
import { readFileSync } from 'fs';

export interface ParsedMessage {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: string;
  uuid: string;
}

export class TranscriptParser {
  /**
   * è§£æ transcript æ–‡ä»¶ï¼Œè¿”å›æŒ‡å®šæ—¶é—´æˆ³ä¹‹åçš„æ–°æ¶ˆæ¯
   */
  static parseNewMessages(
    filePath: string,
    afterTimestamp: Date
  ): ParsedMessage[] {
    // è¯»å–æ–‡ä»¶
    // é€è¡Œè§£æ JSONL
    // è¿‡æ»¤æ—¶é—´æˆ³
    // æå–æ¶ˆæ¯å†…å®¹
    // è¿”å›ç»“æœ
  }

  /**
   * ä» transcript entry ä¸­æå–æ–‡æœ¬å†…å®¹
   */
  private static extractContent(entry: any): string {
    // å¤„ç†ä¸åŒçš„æ¶ˆæ¯æ ¼å¼
    // - çº¯æ–‡æœ¬æ¶ˆæ¯
    // - åŒ…å« tool_use çš„æ¶ˆæ¯
    // - åŒ…å« tool_result çš„æ¶ˆæ¯
  }
}
```

**æ¶ˆæ¯æ ¼å¼å‚è€ƒ**:
```typescript
// Transcript æ–‡ä»¶ä¸­çš„æ¶ˆæ¯æ ¼å¼
interface TranscriptEntry {
  type: 'user' | 'assistant';
  uuid: string;
  timestamp: string;  // ISO 8601 æ ¼å¼
  message: {
    role: 'user' | 'assistant';
    content: string | Array<{
      type: 'text' | 'tool_use' | 'tool_result';
      text?: string;
      // ... å…¶ä»–å­—æ®µ
    }>;
  };
  sessionId: string;
  cwd: string;
}
```

**æ³¨æ„äº‹é¡¹**:
- âš ï¸ å¤„ç† JSONL è§£æé”™è¯¯ï¼ˆè·³è¿‡æ— æ•ˆè¡Œï¼‰
- âš ï¸ æ­£ç¡®æå–åµŒå¥—çš„æ–‡æœ¬å†…å®¹
- âš ï¸ æ—¶é—´æˆ³æ¯”è¾ƒè¦ç²¾ç¡®åˆ°æ¯«ç§’
- âš ï¸ å¤„ç†ç©ºæ¶ˆæ¯æˆ–æ— æ•ˆæ¶ˆæ¯

---

### ç¬¬ä¸‰æ­¥ï¼šåŒæ­¥å¼•æ“ (sync-engine.ts)

**ä½ç½®**: `electron/services/sync-engine.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
1. åè°ƒæ–‡ä»¶ç›‘å¬å’Œæ•°æ®åº“æ›´æ–°
2. æ‰¹é‡æ’å…¥æ–°æ¶ˆæ¯åˆ°æ•°æ®åº“
3. æ›´æ–°ä¼šè¯çš„ updated_at æ—¶é—´æˆ³
4. é€šçŸ¥æ¸²æŸ“è¿›ç¨‹åˆ·æ–° UI

**å…³é”®ä»£ç ç»“æ„**:
```typescript
import { BrowserWindow } from 'electron';
import { getDb } from '../lib/db';
import { TranscriptParser } from './transcript-parser';

export class SyncEngine {
  constructor(private mainWindow: BrowserWindow) {}

  async syncSession(sessionId: string, transcriptPath: string): Promise<void> {
    // 1. è·å–æ•°æ®åº“ä¸­æœ€åä¸€æ¡æ¶ˆæ¯çš„æ—¶é—´æˆ³
    // 2. è§£æ transcript æ–‡ä»¶ï¼Œè·å–æ–°æ¶ˆæ¯
    // 3. æ‰¹é‡æ’å…¥æ–°æ¶ˆæ¯åˆ°æ•°æ®åº“
    // 4. æ›´æ–°ä¼šè¯çš„ updated_at
    // 5. é€šçŸ¥æ¸²æŸ“è¿›ç¨‹
  }

  private getLastMessageTimestamp(sessionId: string): Date {
    // æŸ¥è¯¢æ•°æ®åº“
  }

  private insertMessages(sessionId: string, messages: ParsedMessage[]): void {
    // æ‰¹é‡æ’å…¥ï¼Œä½¿ç”¨ INSERT OR IGNORE é¿å…é‡å¤
  }

  private notifyRenderer(sessionId: string, messageCount: number): void {
    // å‘é€ IPC äº‹ä»¶
    this.mainWindow.webContents.send('sync-messages', {
      sessionId,
      messageCount,
      timestamp: new Date().toISOString(),
    });
  }
}
```

**æ•°æ®åº“æ“ä½œ**:
```sql
-- è·å–æœ€åä¸€æ¡æ¶ˆæ¯çš„æ—¶é—´æˆ³
SELECT created_at FROM messages
WHERE session_id = ?
ORDER BY created_at DESC
LIMIT 1;

-- æ’å…¥æ–°æ¶ˆæ¯ï¼ˆä½¿ç”¨ OR IGNORE é¿å…é‡å¤ï¼‰
INSERT OR IGNORE INTO messages
(id, session_id, role, content, created_at, token_usage)
VALUES (?, ?, ?, ?, ?, NULL);

-- æ›´æ–°ä¼šè¯æ—¶é—´æˆ³
UPDATE chat_sessions
SET updated_at = ?
WHERE id = ?;
```

**æ³¨æ„äº‹é¡¹**:
- âš ï¸ ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- âš ï¸ å¤„ç†æ•°æ®åº“é”å®šæƒ…å†µ
- âš ï¸ è®°å½•åŒæ­¥æ—¥å¿—ä¾¿äºè°ƒè¯•
- âš ï¸ å¤„ç†åŒæ­¥å¤±è´¥çš„æƒ…å†µ

---

## ğŸ“ å®ç°æ­¥éª¤ï¼ˆåˆ†é˜¶æ®µï¼‰

### Phase 1: æ ¸å¿ƒåŠŸèƒ½å®ç° (2-3 å¤©)

**ä»»åŠ¡æ¸…å•**:
- [ ] å®‰è£…ä¾èµ– (chokidar)
- [ ] å®ç° TranscriptParser
  - [ ] ç¼–å†™è§£æé€»è¾‘
  - [ ] æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] å®ç° FileWatcherService
  - [ ] åŸºç¡€ç›‘å¬åŠŸèƒ½
  - [ ] é˜²æŠ–å¤„ç†
  - [ ] ä¼šè¯è¿‡æ»¤
- [ ] å®ç° SyncEngine
  - [ ] æ•°æ®åº“æ“ä½œ
  - [ ] IPC é€šä¿¡
- [ ] åœ¨ electron/main.ts ä¸­é›†æˆ
  - [ ] åˆå§‹åŒ–æœåŠ¡
  - [ ] å¤„ç†åº”ç”¨é€€å‡º

**æµ‹è¯•æ–¹æ³•**:
1. åœ¨ CLI ä¸­å‘é€æ¶ˆæ¯
2. è§‚å¯Ÿ CodePilot æ˜¯å¦è‡ªåŠ¨æ›´æ–°
3. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æ­£ç¡®æ’å…¥æ¶ˆæ¯
4. éªŒè¯æ²¡æœ‰é‡å¤æ¶ˆæ¯

---

### Phase 2: å‰ç«¯é›†æˆ (1 å¤©)

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º useSyncListener Hook
- [ ] åˆ›å»º SyncStatusIndicator ç»„ä»¶
- [ ] åœ¨èŠå¤©é¡µé¢é›†æˆåŒæ­¥çŠ¶æ€
- [ ] æ·»åŠ åŒæ­¥é€šçŸ¥ï¼ˆtoastï¼‰
- [ ] å¤„ç†æ¶ˆæ¯åˆ—è¡¨è‡ªåŠ¨æ»šåŠ¨

**UI è®¾è®¡**:
```
èŠå¤©ç•Œé¢å³ä¸Šè§’ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¢ Synced 2 mins ago        â”‚  â† åŒæ­¥çŠ¶æ€æŒ‡ç¤ºå™¨
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¶ˆæ¯åˆ—è¡¨ä¸­ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â„¹ï¸ 3 new messages from CLI  â”‚  â† åŒæ­¥é€šçŸ¥
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Phase 3: è®¾ç½®ä¸é…ç½® (1 å¤©)

**ä»»åŠ¡æ¸…å•**:
- [ ] åœ¨è®¾ç½®é¡µé¢æ·»åŠ åŒæ­¥å¼€å…³
- [ ] æ·»åŠ åŒæ­¥æ—¥å¿—æŸ¥çœ‹
- [ ] æ·»åŠ æ‰‹åŠ¨è§¦å‘åŒæ­¥æŒ‰é’®
- [ ] ä¿å­˜ç”¨æˆ·é…ç½®åˆ°æ•°æ®åº“

**è®¾ç½®ç•Œé¢**:
```
Settings > CLI Integration
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜‘ Enable real-time sync with CLI   â”‚
â”‚                                     â”‚
â”‚ Sync Status: Active                 â”‚
â”‚ Watching: 5 sessions                â”‚
â”‚ Last sync: 2 minutes ago            â”‚
â”‚                                     â”‚
â”‚ [View Sync Log]  [Sync Now]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª æµ‹è¯•è®¡åˆ’

### å•å…ƒæµ‹è¯•

**TranscriptParser æµ‹è¯•**:
```typescript
describe('TranscriptParser', () => {
  it('should parse valid JSONL file', () => {});
  it('should filter messages by timestamp', () => {});
  it('should extract text from complex content', () => {});
  it('should handle malformed lines gracefully', () => {});
});
```

**SyncEngine æµ‹è¯•**:
```typescript
describe('SyncEngine', () => {
  it('should sync new messages to database', () => {});
  it('should not duplicate existing messages', () => {});
  it('should update session timestamp', () => {});
  it('should notify renderer process', () => {});
});
```

### é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
1. **åŸºç¡€åŒæ­¥**
   - åœ¨ CLI ä¸­å‘é€æ¶ˆæ¯
   - éªŒè¯ CodePilot è‡ªåŠ¨æ˜¾ç¤º

2. **æ‰¹é‡åŒæ­¥**
   - åœ¨ CLI ä¸­å¿«é€Ÿå‘é€å¤šæ¡æ¶ˆæ¯
   - éªŒè¯é˜²æŠ–å’Œæ‰¹é‡å¤„ç†

3. **è¾¹ç¼˜æƒ…å†µ**
   - æ–‡ä»¶è¢«åˆ é™¤
   - æ–‡ä»¶æ ¼å¼é”™è¯¯
   - æ•°æ®åº“é”å®š
   - ç½‘ç»œæ–­å¼€ï¼ˆå¦‚æœæ¶‰åŠï¼‰

4. **æ€§èƒ½æµ‹è¯•**
   - ç›‘å¬ 100+ ä¼šè¯
   - å¤§æ–‡ä»¶è§£æï¼ˆ10MB+ transcriptï¼‰
   - å†…å­˜ä½¿ç”¨æƒ…å†µ

---

## âš ï¸ æ³¨æ„äº‹é¡¹ä¸é£é™©

### æŠ€æœ¯é£é™©

1. **æ–‡ä»¶ç›‘å¬æ€§èƒ½**
   - é£é™©ï¼šç›‘å¬å¤§é‡æ–‡ä»¶å¯èƒ½å½±å“æ€§èƒ½
   - ç¼“è§£ï¼šåªç›‘å¬æ´»è·ƒä¼šè¯ï¼Œä½¿ç”¨é˜²æŠ–

2. **æ•°æ®åº“å¹¶å‘**
   - é£é™©ï¼šåŒæ—¶å†™å…¥å¯èƒ½å¯¼è‡´é”å®š
   - ç¼“è§£ï¼šä½¿ç”¨äº‹åŠ¡ï¼Œæ·»åŠ é‡è¯•é€»è¾‘

3. **æ¶ˆæ¯å»é‡**
   - é£é™©ï¼šå¯èƒ½å‡ºç°é‡å¤æ¶ˆæ¯
   - ç¼“è§£ï¼šä½¿ç”¨ UUID ä½œä¸ºä¸»é”®ï¼ŒINSERT OR IGNORE

4. **å†…å­˜æ³„æ¼**
   - é£é™©ï¼šé•¿æ—¶é—´è¿è¡Œå¯èƒ½å†…å­˜æ³„æ¼
   - ç¼“è§£ï¼šæ­£ç¡®æ¸…ç†ç›‘å¬å™¨ï¼Œå®šæœŸæ£€æŸ¥å†…å­˜

### ç”¨æˆ·ä½“éªŒé£é™©

1. **çªç„¶å‡ºç°çš„æ¶ˆæ¯**
   - é£é™©ï¼šç”¨æˆ·å¯èƒ½å›°æƒ‘æ¶ˆæ¯ä»å“ªæ¥
   - ç¼“è§£ï¼šæ˜¾ç¤ºæ¸…æ™°çš„åŒæ­¥é€šçŸ¥

2. **æ»šåŠ¨ä½ç½®**
   - é£é™©ï¼šæ–°æ¶ˆæ¯å‡ºç°æ—¶æ»šåŠ¨ä½ç½®è·³åŠ¨
   - ç¼“è§£ï¼šæ™ºèƒ½æ»šåŠ¨ï¼ˆåªåœ¨åº•éƒ¨æ—¶è‡ªåŠ¨æ»šåŠ¨ï¼‰

3. **æ€§èƒ½æ„ŸçŸ¥**
   - é£é™©ï¼šç”¨æˆ·æ„Ÿè§‰åº”ç”¨å˜æ…¢
   - ç¼“è§£ï¼šåå°åŒæ­¥ï¼Œä¸é˜»å¡ UI

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

- âœ… åŒæ­¥å»¶è¿Ÿ < 2 ç§’
- âœ… CPU ä½¿ç”¨ç‡å¢åŠ  < 5%
- âœ… å†…å­˜ä½¿ç”¨å¢åŠ  < 50MB
- âœ… æ— æ¶ˆæ¯ä¸¢å¤±æˆ–é‡å¤
- âœ… ç”¨æˆ·æ»¡æ„åº¦æå‡

---

## ğŸ”— ç›¸å…³èµ„æº

### ä»£ç å‚è€ƒ
- ç°æœ‰å¯¼å…¥åŠŸèƒ½: `src/app/api/chat/import/route.ts`
- æ•°æ®åº“æ“ä½œ: `src/lib/db.ts`
- Electron IPC: `electron/main.ts`

### æ–‡æ¡£å‚è€ƒ
- [chokidar æ–‡æ¡£](https://github.com/paulmillr/chokidar)
- [Electron IPC æ–‡æ¡£](https://www.electronjs.org/docs/latest/api/ipc-main)
- Claude CLI transcript æ ¼å¼: `~/.claude/projects/`

### ç›¸å…³è®¨è®º
- æœ¬æ¬¡å¯¹è¯è®°å½•: Session `705676de-d2a0-4e4d-b88d-e9101c9eae4b`
- å…³é”®å‘ç°: Claude Agent SDK ä¼šå®æ—¶æ›´æ–° transcript æ–‡ä»¶

---

## ğŸ“… å¼€å‘æ—¶é—´çº¿

```
Week 1:
â”œâ”€ Day 1-2: Phase 1 - æ ¸å¿ƒåŠŸèƒ½å®ç°
â”œâ”€ Day 3: Phase 2 - å‰ç«¯é›†æˆ
â”œâ”€ Day 4: Phase 3 - è®¾ç½®ä¸é…ç½®
â””â”€ Day 5: æµ‹è¯•ä¸ä¼˜åŒ–

Week 2:
â”œâ”€ ç”¨æˆ·æµ‹è¯•
â”œâ”€ Bug ä¿®å¤
â””â”€ æ–‡æ¡£å®Œå–„
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆç»™æœªæ¥çš„å¼€å‘è€…ï¼‰

å½“ä½ å‡†å¤‡å®ç°è¿™ä¸ªåŠŸèƒ½æ—¶ï¼š

1. **é˜…è¯»æœ¬æ–‡æ¡£** - ç†è§£æ•´ä½“æ¶æ„
2. **æŸ¥çœ‹ç›¸å…³ä»£ç ** - ç†Ÿæ‚‰ç°æœ‰å®ç°
3. **å®‰è£…ä¾èµ–** - `npm install chokidar`
4. **ä» Phase 1 å¼€å§‹** - æŒ‰æ­¥éª¤å®ç°
5. **æŒç»­æµ‹è¯•** - æ¯å®Œæˆä¸€ä¸ªæ¨¡å—å°±æµ‹è¯•

**ç¬¬ä¸€ä¸ª PR åº”è¯¥åŒ…å«**:
- TranscriptParser å®ç°
- å•å…ƒæµ‹è¯•
- ä½¿ç”¨æ–‡æ¡£

**é‡åˆ°é—®é¢˜æ—¶**:
- æŸ¥çœ‹ `~/.claude/projects/` ä¸­çš„å®é™…æ–‡ä»¶æ ¼å¼
- ä½¿ç”¨ `console.log` è°ƒè¯• transcript è§£æ
- æ£€æŸ¥æ•°æ®åº“ä¸­çš„æ—¶é—´æˆ³æ ¼å¼

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2026-02-08
**ä½œè€…**: Claude (Sonnet 4.5)
**é¡¹ç›®**: CodePilot - Claude CLI GUI
